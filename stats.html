---
layout: default
title: Adventure Stats
---
<div class="container mx-auto px-4 py-8 max-w-screen-lg">
    <h1 class="text-3xl font-bold mb-6">Adventure Statistics</h1>
    <p class="mb-4"><a href="{{ site.baseurl }}/" class="text-blue-500 hover:underline">Return to Main Page</a></p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
            <h2 class="text-xl font-semibold mb-4">Adventures by Tier</h2>
            <canvas id="tier-chart"></canvas>
        </div>
        <div>
            <h2 class="text-xl font-semibold mb-4">Adventures by Duration</h2>
            <canvas id="duration-chart"></canvas>
        </div>
        <div>
            <h2 class="text-xl font-semibold mb-4">Adventures by Campaign</h2>
            <canvas id="campaign-chart"></canvas>
        </div>
        <div>
            <h2 class="text-xl font-semibold mb-4">Adventures by Season</h2>
            <canvas id="season-chart"></canvas>
        </div>
    </div>

    <div class="mt-8">
        <h2 class="text-2xl font-semibold mb-6">Seed Usage by Season</h2>
        <p class="mb-4 text-gray-600">Pie charts showing how popular each seed is for POA, WBW, and SJ campaigns. <strong>Tip:</strong> Click on any item in the legend to exclude it from the chart. Click again to include it.</p>
        <div id="seed-charts-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Seed charts will be dynamically generated here -->
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    fetch('assets/data/stats.json')
        .then(response => response.json())
        .then(data => {
            // Sort tiers: Tier 1, Tier 2, Tier 3, Tier 4, Unknown
            const tierLabels = ['Tier 1', 'Tier 2', 'Tier 3', 'Tier 4', 'Unknown'];
            const tierData = tierLabels.map(label => data.tier[label] || 0);
            
            const tierCtx = document.getElementById('tier-chart').getContext('2d');
            new Chart(tierCtx, {
                type: 'bar',
                data: {
                    labels: tierLabels,
                    datasets: [{
                        label: '# of Adventures',
                        data: tierData,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Sort duration: 1, 2, 4, 6, 8, All Others, Unknown
            const durationOrder = ['1 Hours', '2 Hours', '4 Hours', '6 Hours', '8 Hours', 'All Others', 'Unknown'];
            const durationLabels = durationOrder.filter(label => data.duration[label] !== undefined && data.duration[label] > 0);
            const durationData = durationLabels.map(label => data.duration[label]);
            
            const durationCtx = document.getElementById('duration-chart').getContext('2d');
            new Chart(durationCtx, {
                type: 'bar',
                data: {
                    labels: durationLabels,
                    datasets: [{
                        label: '# of Adventures',
                        data: durationData,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Campaign as pie chart
            const campaignLabels = Object.keys(data.campaign);
            const campaignData = Object.values(data.campaign);
            const campaignColors = [
                '#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', 
                '#1abc9c', '#e67e22', '#34495e', '#16a085', '#27ae60'
            ];
            const campaignChartColors = campaignLabels.map((_, i) => campaignColors[i % campaignColors.length]);
            
            const campaignCtx = document.getElementById('campaign-chart').getContext('2d');
            new Chart(campaignCtx, {
                type: 'pie',
                data: {
                    labels: campaignLabels,
                    datasets: [{
                        data: campaignData,
                        backgroundColor: campaignChartColors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 11
                                },
                                boxWidth: 12,
                                padding: 8
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = campaignData.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                    return label + ': ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // Filter out "Unknown" from season data
            const seasonDataFiltered = {};
            Object.keys(data.season).forEach(key => {
                if (key !== 'Unknown') {
                    seasonDataFiltered[key] = data.season[key];
                }
            });
            
            const seasonCtx = document.getElementById('season-chart').getContext('2d');
            new Chart(seasonCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(seasonDataFiltered),
                    datasets: [{
                        label: '# of Adventures',
                        data: Object.values(seasonDataFiltered),
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Helper function to create seed charts
            function createSeedChart(container, seasonName, seeds, counts, total, colors, chartIndex, subtitle) {
                // Create chart container
                const chartDiv = document.createElement('div');
                chartDiv.className = 'bg-white p-4 rounded-lg shadow';
                
                const chartTitle = document.createElement('h3');
                chartTitle.className = 'text-lg font-semibold mb-2';
                chartTitle.textContent = seasonName + (subtitle ? ` - ${subtitle}` : '');
                chartDiv.appendChild(chartTitle);

                const chartInfo = document.createElement('p');
                chartInfo.className = 'text-sm text-gray-600 mb-4';
                chartInfo.textContent = `Total adventures with seeds: ${total}`;
                chartDiv.appendChild(chartInfo);

                const canvas = document.createElement('canvas');
                canvas.id = `seed-chart-${chartIndex}`;
                chartDiv.appendChild(canvas);
                container.appendChild(chartDiv);

                // Generate colors for this chart
                const chartColors = seeds.map((_, i) => colors[i % colors.length]);

                // Create pie chart
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: seeds,
                        datasets: [{
                            data: counts,
                            backgroundColor: chartColors
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        size: 11
                                    },
                                    boxWidth: 12,
                                    padding: 8
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                        return label + ': ' + value + ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Generate seed charts
            if (data.seed_by_season && Object.keys(data.seed_by_season).length > 0) {
                const seedChartsContainer = document.getElementById('seed-charts-container');
                const colors = [
                    '#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', 
                    '#1abc9c', '#e67e22', '#34495e', '#16a085', '#27ae60',
                    '#c0392b', '#8e44ad', '#2980b9', '#d35400', '#7f8c8d'
                ];

                // Define sort order: Icewind Dale/Plague of Ancients, Wild Beyond the Witchlight, Spelljammer
                const seasonOrder = {
                    'Plague of Ancients (DC-POA)': 1,
                    'Icewind Dale (DC-POA)': 1, // Also handle old name if it exists
                    'Wild Beyond the Witchlight (WBW-DC)': 2,
                    'Spelljammer (SJ-DC)': 3
                };

                // Sort seasons by defined order
                const sortedSeasons = Object.keys(data.seed_by_season).sort((a, b) => {
                    const orderA = seasonOrder[a] || 999;
                    const orderB = seasonOrder[b] || 999;
                    return orderA - orderB;
                });

                let chartIndex = 0;
                sortedSeasons.forEach((seasonName) => {
                    const seedCounts = data.seed_by_season[seasonName];
                    const seeds = Object.keys(seedCounts);
                    const counts = Object.values(seedCounts);
                    const total = counts.reduce((a, b) => a + b, 0);

                    if (total === 0) return;

                    // Create one chart per season (users can click legend items to exclude them)
                    createSeedChart(seedChartsContainer, seasonName, seeds, counts, total, colors, chartIndex++, null);
                });
            }
        });
</script>
