
# catalog.json Format Documentation

The `catalog.json` file is a minified JSON file used by the Adventurers League Adventure Catalog frontend for filtering and displaying adventures. It is generated by `maintaindb/aggregator.py`.

## Structure

```json
{
  "last_update": "YYYYMMDD",
  "adventures": [
    {
      "i": "product_id",
      "n": "Title",
      "c": "Adventure Code",
      "a": ["Author 1", "Author 2"],
      "s": "Season Display Name",
      "h": "Hours",
      "t": TierNumber,
      "d": "YYYYMMDD",
      "p": CampaignBitmask,
      "f": FlagBitmask,
      "u": "Optional Override URL",
      "e": "Optional Seed/Meta",
      "lu": "Last Update per Adventure"
    }
  ]
}
```

## Field Definitions

| Key | Original Name | Type | Description |
| :--- | :--- | :--- | :--- |
| `i` | `product_id` | String | Unique identifier from DMsGuild. May include suffixes like `-1`, `-2` for components. |
| `n` | `title` | String | The adventure title. |
| `c` | `code` | String | The official adventure code (e.g., `DDAL09-01`). |
| `a` | `authors` | Array | List of author names. |
| `s` | `season` | String | Formatted season name (e.g., `11 - The Wild Beyond the Witchlight`). |
| `h` | `hours` | String | Duration or duration range (e.g., `2`, `2-4`). |
| `t` | `tiers` | Integer | The adventure tier (1, 2, 3, or 4). |
| `d` | `date_created` | String | The creation/publication date in `YYYYMMDD` format. |
| `p` | `campaigns` | Integer | **Bitmask** for campaigns. See below. |
| `f` | `flags` | Integer | **Bitmask** for classification flags. See below. |
| `u` | `url` | String | Optional. Only present if the URL does NOT follow the standard DMsGuild affiliate pattern. |
| `e` | `seed` | String | Optional. Supplementary info or "seed" metadata. |
| `lu`| `last_update` | String | Optional. Last modification date for this specific entry. |

## Bitmasks

### Campaign Bitmask (`p`)

A bitwise OR of the following values:

| Value | Bit | Campaign |
| :--- | :--- | :--- |
| 1 | 0 | Forgotten Realms |
| 2 | 1 | Eberron |
| 4 | 2 | Ravenloft |
| 8 | 3 | Dragonlance |

Example: `p: 3` means the adventure is part of both Forgotten Realms and Eberron.

### Flags Bitmask (`f`)

A bitwise OR of the following values:

| Value | Bit | Flag |
| :--- | :--- | :--- |
| 1 | 0 | `community_content` |
| 2 | 1 | `dungeoncraft` |
| 4 | 2 | `salvage_mission` |

Example: `f: 3` means it is both Community Content and Dungeoncraft.

## Optimizations

### URL Derivation
If the `u` field is missing, the URL should be derived as:
`https://www.dmsguild.com/product/{base_product_id}/?affiliate_id=171040`
where `base_product_id` is the `i` field with any trailing dash and numbers removed (e.g., `200609-2` becomes `200609`).

### Omitted Fields
To save space, the following fields are omitted if they are null, empty, or have their default value:
- `u`: Omitted if it matches the standard pattern.
- `f`: Omitted if 0 (no flags).
- `p`: Omitted if 0 (no known campaign).
- `e`: Omitted if null or empty.
- `lu`: Omitted if not available.
